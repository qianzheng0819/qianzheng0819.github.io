<!DOCTYPE html>
<!-- saved from url=(0042)http://gityuan.com/2015/11/23/binder-aidl/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" content="max-age=36000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="gityuan">
    <meta name="keyword" content="Android,Gityuan,Android博客,Android源码,袁辉辉">
    <meta name="description" content="Android架构,Gityuan,Android博客,Android源码,袁辉辉">
    <meta name="baidu-site-verification" content="LToTaY8RGk">
    <link rel="shortcut icon" href="http://gityuan.com/images/favicon.ico">
    <title>Binder系列9—如何使用AIDL - Gityuan博客 | 袁辉辉的Android博客</title>

    <link rel="canonical" href="http://gityuan.com/2015/11/23/binder-aidl/">

    <!-- Bootstrap Core CSS -->
    <style class="anchorjs"></style><link rel="stylesheet" href="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/syntax.css">

    <!-- Custom Fonts -->
    <!-- change font-awesome CDN to qiniu -->
    <link href="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <!-- add highlight -->
    <link rel="stylesheet" href="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/androidstudio.css">
		<script src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/jquery.nav.js.下载"></script><script src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/fastclick.min.js.下载"></script><script src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/hm.js.下载"></script><script src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/anchor.min.js.下载"></script><script type="text/javascript" src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/highlight.pack.js.下载"></script>
		<script>hljs.initHighlightingOnLoad();</script>
		
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://gityuan.com/">Gityuan</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar" class=" ">
            <div class="navbar-collapse" style="height: 0px;">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://gityuan.com/">首页</a></li>
                    <li><a href="http://gityuan.com/archive">目录</a></li>
                    <!--<li><a href="/tags">标签</a></li>-->
                    <li><a href="http://gityuan.com/talk">留言区</a></li>
                    <li><a href="http://gityuan.com/about">关于</a></li>
                    <li><a href="http://gityuan.com/friends">友链</a></li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- _posts目录文章布局-->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/');
    }

    
</style>
<header class="intro-header">
    <div class="header-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a target="_blank" class="tag" href="http://gityuan.com/tags/#android" title="android">android</a>
                        
                        <a target="_blank" class="tag" href="http://gityuan.com/tags/#binder" title="binder">binder</a>
                        
                    </div>
                    <h1 id="binder9aidl">Binder系列9—如何使用AIDL</h1>
                    
                    
                    <h2 class="subheading" id=""></h2>
                    
                    <span class="meta">Posted by Gityuan on November 23, 2015</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

								<blockquote>
  <p>自定义binder架构的 client/ server组件</p>
</blockquote>

<h2 id="一aidl">一、AIDL<a class="anchorjs-link " href="http://gityuan.com/2015/11/23/binder-aidl/#%E4%B8%80aidl" aria-label="Anchor link for: 一aidl" data-anchorjs-icon="#" style="opacity: 1; padding-left: 0.375em;"></a></h2>

<h3 id="11-server端">1.1 Server端<a class="anchorjs-link " href="http://gityuan.com/2015/11/23/binder-aidl/#11-server%E7%AB%AF" aria-label="Anchor link for: 11 server端" data-anchorjs-icon="#" style="opacity: 1; padding-left: 0.375em;"></a></h3>

<p>RemoteService.java</p>

<p>本例是为了演示进程间的通信机制，故需要将Service与Activity处于不同的进程，需要在AndroidManifest.xml中，把service配置成<code class="highlighter-rouge">android:process=":remote"</code>,进程也可以命名成其他的。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RemoteService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Service</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = <span class="hljs-string">"BinderSimple"</span>;

    MyData mMyData;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate();
        Log.i(TAG, <span class="hljs-string">"[RemoteService] onCreate"</span>);
        initMyData();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IBinder <span class="hljs-title">onBind</span><span class="hljs-params">(Intent intent)</span> </span>{
        Log.i(TAG,<span class="hljs-string">"[RemoteService] onBind"</span>);
        <span class="hljs-keyword">return</span> mBinder;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onUnbind</span><span class="hljs-params">(Intent intent)</span> </span>{
        Log.i(TAG, <span class="hljs-string">"[RemoteService] onUnbind"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onUnbind(intent);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span> </span>{
        Log.i(TAG, <span class="hljs-string">"[RemoteService] onDestroy"</span>);
        <span class="hljs-keyword">super</span>.onDestroy();
    }

    <span class="hljs-comment">/**
     * 实现IRemoteService.aidl中定义的方法
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IRemoteService.Stub mBinder = <span class="hljs-keyword">new</span> IRemoteService.Stub() {

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPid</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException </span>{
            Log.i(TAG,<span class="hljs-string">"[RemoteService] getPid()="</span>+android.os.Process.myPid());
            <span class="hljs-keyword">return</span> android.os.Process.myPid();
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> MyData <span class="hljs-title">getMyData</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException </span>{
            Log.i(TAG,<span class="hljs-string">"[RemoteService] getMyData()  "</span>+ mMyData.toString());
            <span class="hljs-keyword">return</span> mMyData;
        }

        <span class="hljs-comment">/**此处可用于权限拦截**/</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onTransact</span><span class="hljs-params">(<span class="hljs-keyword">int</span> code, Parcel data, Parcel reply, <span class="hljs-keyword">int</span> flags)</span> <span class="hljs-keyword">throws</span> RemoteException </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onTransact(code, data, reply, flags);
        }
    };

    <span class="hljs-comment">/**
     * 初始化MyData数据
     **/</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initMyData</span><span class="hljs-params">()</span> </span>{
        mMyData = <span class="hljs-keyword">new</span> MyData();
        mMyData.setData1(<span class="hljs-number">10</span>);
        mMyData.setData2(<span class="hljs-number">20</span>);
    }
}
</code></pre></div></div>

<h3 id="12-client端">1.2 Client端<a class="anchorjs-link " href="http://gityuan.com/2015/11/23/binder-aidl/#12-client%E7%AB%AF" aria-label="Anchor link for: 12 client端" data-anchorjs-icon="#" style="opacity: 1; padding-left: 0.375em;"></a></h3>

<p>ClientActivity.java</p>

<pre><code class="language-Java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClientActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = <span class="hljs-string">"BinderSimple"</span>;

    <span class="hljs-keyword">private</span> IRemoteService mRemoteService;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> mIsBound;
    <span class="hljs-keyword">private</span> TextView mCallBackTv;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        Log.i(TAG, <span class="hljs-string">"[ClientActivity] onCreate"</span>);

        setContentView(R.layout.activity_main);

        mCallBackTv = (TextView) findViewById(R.id.tv_callback);
        mCallBackTv.setText(R.string.remote_service_unattached);
    }

    <span class="hljs-comment">/**
     * 用语监控远程服务连接的状态
     */</span>
    <span class="hljs-keyword">private</span> ServiceConnection mConnection = <span class="hljs-keyword">new</span> ServiceConnection() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onServiceConnected</span><span class="hljs-params">(ComponentName name, IBinder service)</span> </span>{

            mRemoteService = IRemoteService.Stub.asInterface(service);
            String pidInfo = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">try</span> {
                MyData myData = mRemoteService.getMyData();
                pidInfo = <span class="hljs-string">"pid="</span>+ mRemoteService.getPid() +
                        <span class="hljs-string">", data1 = "</span>+ myData.getData1() +
                        <span class="hljs-string">", data2="</span>+ myData.getData2();
            } <span class="hljs-keyword">catch</span> (RemoteException e) {
                e.printStackTrace();
            }
            Log.i(TAG, <span class="hljs-string">"[ClientActivity] onServiceConnected  "</span>+pidInfo);
            mCallBackTv.setText(pidInfo);
            Toast.makeText(ClientActivity.<span class="hljs-keyword">this</span>, R.string.remote_service_connected, Toast.LENGTH_SHORT).show();
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onServiceDisconnected</span><span class="hljs-params">(ComponentName name)</span> </span>{
            Log.i(TAG, <span class="hljs-string">"[ClientActivity] onServiceDisconnected"</span>);
            mCallBackTv.setText(R.string.remote_service_disconnected);
            mRemoteService = <span class="hljs-keyword">null</span>;
            Toast.makeText(ClientActivity.<span class="hljs-keyword">this</span>, R.string.remote_service_disconnected, Toast.LENGTH_SHORT).show();
        }
    };


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clickHandler</span><span class="hljs-params">(View view)</span></span>{
        <span class="hljs-keyword">switch</span> (view.getId()){
            <span class="hljs-keyword">case</span> R.id.btn_bind:
                bindRemoteService();
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> R.id.btn_unbind:
                unbindRemoteService();
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> R.id.btn_kill:
                killRemoteService();
                <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-comment">/**
     * 绑定远程服务
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bindRemoteService</span><span class="hljs-params">()</span></span>{
        Log.i(TAG, <span class="hljs-string">"[ClientActivity] bindRemoteService"</span>);
        Intent intent = <span class="hljs-keyword">new</span> Intent(ClientActivity.<span class="hljs-keyword">this</span>, RemoteService.class);
        intent.setAction(IRemoteService.class.getName());
        bindService(intent, mConnection, Context.BIND_AUTO_CREATE);

        mIsBound = <span class="hljs-keyword">true</span>;
        mCallBackTv.setText(R.string.binding);
    }

    <span class="hljs-comment">/**
     * 解除绑定远程服务
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unbindRemoteService</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">if</span>(!mIsBound){
            <span class="hljs-keyword">return</span>;
        }
        Log.i(TAG, <span class="hljs-string">"[ClientActivity] unbindRemoteService ==&gt;"</span>);
        unbindService(mConnection);
        mIsBound = <span class="hljs-keyword">false</span>;
        mCallBackTv.setText(R.string.unbinding);
    }

    <span class="hljs-comment">/**
     * 杀死远程服务
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">killRemoteService</span><span class="hljs-params">()</span></span>{
        Log.i(TAG, <span class="hljs-string">"[ClientActivity] killRemoteService"</span>);
        <span class="hljs-keyword">try</span> {
            android.os.Process.killProcess(mRemoteService.getPid());
            mCallBackTv.setText(R.string.kill_success);
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            e.printStackTrace();
            Toast.makeText(ClientActivity.<span class="hljs-keyword">this</span>, R.string.kill_failure, Toast.LENGTH_SHORT).show();
        }
    }
}
</code></pre>

<h3 id="13-aidl文件">1.3 AIDL文件<a class="anchorjs-link " href="http://gityuan.com/2015/11/23/binder-aidl/#13-aidl%E6%96%87%E4%BB%B6" aria-label="Anchor link for: 13 aidl文件" data-anchorjs-icon="#" style="opacity: 1; padding-left: 0.375em;"></a></h3>

<p>(1)IRemoteService.aidl
定义远程通信的接口方法</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IRemoteService</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getPid</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">MyData <span class="hljs-title">getMyData</span><span class="hljs-params">()</span></span>;
}
</code></pre></div></div>

<p>(2)MyData.aidl
定义远程通信的自定义数据</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code class="hljs nginx"><span class="hljs-attribute">parcelable</span> MyData;
</code></pre></div></div>

<h3 id="14-parcel数据">1.4 Parcel数据<a class="anchorjs-link " href="http://gityuan.com/2015/11/23/binder-aidl/#14-parcel%E6%95%B0%E6%8D%AE" aria-label="Anchor link for: 14 parcel数据" data-anchorjs-icon="#" style="opacity: 1; padding-left: 0.375em;"></a></h3>
<p>MyData.java</p>

<pre><code class="language-Java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Parcelable</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> data1;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> data2;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyData</span><span class="hljs-params">()</span></span>{

    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">MyData</span><span class="hljs-params">(Parcel in)</span> </span>{
        readFromParcel(in);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Creator&lt;MyData&gt; CREATOR = <span class="hljs-keyword">new</span> Creator&lt;MyData&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> MyData <span class="hljs-title">createFromParcel</span><span class="hljs-params">(Parcel in)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyData(in);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> MyData[] newArray(<span class="hljs-keyword">int</span> size) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyData[size];
        }
    };

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">describeContents</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">/** 将数据写入到Parcel **/</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeToParcel</span><span class="hljs-params">(Parcel dest, <span class="hljs-keyword">int</span> flags)</span> </span>{
        dest.writeInt(data1);
        dest.writeInt(data2);
    }

    <span class="hljs-comment">/** 从Parcel中读取数据 **/</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readFromParcel</span><span class="hljs-params">(Parcel in)</span></span>{
        data1 = in.readInt();
        data2 = in.readInt();
    }


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getData2</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> data2;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setData2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> data2)</span> </span>{
        <span class="hljs-keyword">this</span>.data2 = data2;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getData1</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> data1;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setData1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> data1)</span> </span>{
        <span class="hljs-keyword">this</span>.data1 = data1;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"data1 = "</span>+ data1 + <span class="hljs-string">", data2="</span>+ data2;
    }
}
</code></pre>

<h3 id="15-运行">1.5 运行<a class="anchorjs-link " href="http://gityuan.com/2015/11/23/binder-aidl/#15-%E8%BF%90%E8%A1%8C" aria-label="Anchor link for: 15 运行" data-anchorjs-icon="#" style="opacity: 1; padding-left: 0.375em;"></a></h3>

<p>该工程会生成一个apk，安装到手机，打开apk，界面如下：</p>

<p><img src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/apk_ui.png" alt="apk"></p>

<p>界面上有三个按钮，分别是功能分别是bindService(绑定Service), unbindService(解除绑定Service), killProcess(杀死Service进程)。</p>

<p>从左往右，依次点击界面，可得：</p>

<p><img src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/logcat_BinderSimple.png" alt="apk"></p>

<h2 id="二原理分析">二、原理分析<a class="anchorjs-link " href="http://gityuan.com/2015/11/23/binder-aidl/#%E4%BA%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90" aria-label="Anchor link for: 二原理分析" data-anchorjs-icon="#" style="opacity: 1; padding-left: 0.375em;"></a></h2>

<p>调用图：</p>

<p><img src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/MyServer_java_binder.jpg" alt="aidl image"></p>

<p>采用AIDL技术，是原理还是利用framework binder的架构。本文的实例AIDL会自动生成一个与之相对应的IRemoteService.java文件，如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code class="hljs java"><span class="k"><span class="hljs-keyword">package</span></span> <span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">;</span>
<span class="k"><span class="hljs-keyword">public</span></span> <span class="n"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-title">IRemoteService</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">os</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">IInterface</span></span></span><span class="hljs-class"> </span><span class="p">{</span>
    <span class="p"><span class="hljs-comment">/**</span></span><span class="hljs-comment">
     </span><span class="p"><span class="hljs-comment">*</span></span><span class="hljs-comment"> </span><span class="n"><span class="hljs-comment">Local</span></span><span class="p"><span class="hljs-comment">-</span></span><span class="n"><span class="hljs-comment">side</span></span><span class="hljs-comment"> </span><span class="n"><span class="hljs-comment">IPC</span></span><span class="hljs-comment"> </span><span class="n"><span class="hljs-comment">implementation</span></span><span class="hljs-comment"> </span><span class="n"><span class="hljs-comment">stub</span></span><span class="hljs-comment"> </span><span class="n"><span class="hljs-comment">class</span></span><span class="p"><span class="hljs-comment">.</span></span><span class="hljs-comment">
     </span><span class="p"><span class="hljs-comment">*/</span></span>
    <span class="k"><span class="hljs-keyword">public</span></span> <span class="n"><span class="hljs-keyword">static</span></span> <span class="n"><span class="hljs-keyword">abstract</span></span> <span class="n"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-title">Stub</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">os</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">Binder</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">yuanhh</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">appbinderdemo</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">IRemoteService</span></span></span><span class="hljs-class"> </span><span class="p">{</span>
        <span class="n"><span class="hljs-keyword">private</span></span> <span class="n"><span class="hljs-keyword">static</span></span> <span class="n"><span class="hljs-keyword">final</span></span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="k">String</span> <span class="n">DESCRIPTOR</span> <span class="p">=</span> <span class="s2"><span class="hljs-string">"com.yuanhh.appbinderdemo.IRemoteService"</span></span><span class="p">;</span>

        <span class="p"><span class="hljs-comment">/**</span></span><span class="hljs-comment">
         </span><span class="p"><span class="hljs-comment">*</span></span><span class="hljs-comment"> </span><span class="n"><span class="hljs-comment">Stub</span></span><span class="err"><span class="hljs-comment">构造函数</span></span><span class="hljs-comment">
         </span><span class="p"><span class="hljs-comment">*/</span></span>
        <span class="k"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">Stub</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="p">{</span>
            <span class="n"><span class="hljs-keyword">this</span></span><span class="p">.</span><span class="n">attachInterface</span><span class="p">(</span><span class="n"><span class="hljs-keyword">this</span></span><span class="p">,</span> <span class="n">DESCRIPTOR</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p"><span class="hljs-comment">/**</span></span><span class="hljs-comment">
         </span><span class="p"><span class="hljs-comment">*</span></span><span class="hljs-comment"> </span><span class="err"><span class="hljs-comment">将</span></span><span class="n"><span class="hljs-comment">IBinder</span></span><span class="hljs-comment"> </span><span class="err"><span class="hljs-comment">转换为</span></span><span class="n"><span class="hljs-comment">IRemoteService</span></span><span class="hljs-comment"> </span><span class="n"><span class="hljs-comment">interface</span></span><span class="hljs-comment">
         </span><span class="p"><span class="hljs-comment">*/</span></span>
        <span class="k"><span class="hljs-keyword">public</span></span> <span class="n"><span class="hljs-keyword">static</span></span> <span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">.</span><span class="n"><span class="hljs-function">IRemoteService</span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">asInterface</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">(</span></span></span><span class="n"><span class="hljs-function"><span class="hljs-params">android</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class="n"><span class="hljs-function"><span class="hljs-params">os</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class="n"><span class="hljs-function"><span class="hljs-params">IBinder</span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="n"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="p">{</span>
            <span class="k"><span class="hljs-keyword">if</span></span> <span class="p">((</span><span class="n">obj</span> <span class="p">==</span> <span class="n"><span class="hljs-keyword">null</span></span><span class="p">))</span> <span class="p">{</span>
                <span class="n"><span class="hljs-keyword">return</span></span> <span class="n"><span class="hljs-keyword">null</span></span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">IInterface</span> <span class="n">iin</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">queryLocalInterface</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">);</span>
            <span class="k"><span class="hljs-keyword">if</span></span> <span class="p">(((</span><span class="n">iin</span> <span class="c1">!= <span class="hljs-keyword">null</span>) &amp;&amp; (iin <span class="hljs-keyword">instanceof</span> com.yuanhh.appbinderdemo.IRemoteService))) {
</span>                <span class="n"><span class="hljs-keyword">return</span></span> <span class="p">((</span><span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">.</span><span class="n">IRemoteService</span><span class="p">)</span> <span class="n">iin</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n"><span class="hljs-keyword">return</span></span> <span class="n"><span class="hljs-keyword">new</span></span> <span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">.</span><span class="n">IRemoteService</span><span class="p">.</span><span class="n">Stub</span><span class="p">.</span><span class="n">Proxy</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p"><span class="hljs-meta">@</span></span><span class="n"><span class="hljs-meta">Override</span></span>
        <span class="k"><span class="hljs-keyword">public</span></span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n"><span class="hljs-function">IBinder</span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">asBinder</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="p">{</span>
            <span class="n"><span class="hljs-keyword">return</span></span> <span class="n"><span class="hljs-keyword">this</span></span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p"><span class="hljs-meta">@</span></span><span class="n"><span class="hljs-meta">Override</span></span>
        <span class="k"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="k"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">onTransact</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">(</span></span></span><span class="n"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="n"><span class="hljs-function"><span class="hljs-params">code</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">,</span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="n"><span class="hljs-function"><span class="hljs-params">android</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class="n"><span class="hljs-function"><span class="hljs-params">os</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class="n"><span class="hljs-function"><span class="hljs-params">Parcel</span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="n"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">,</span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="n"><span class="hljs-function"><span class="hljs-params">android</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class="n"><span class="hljs-function"><span class="hljs-params">os</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class="n"><span class="hljs-function"><span class="hljs-params">Parcel</span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="n"><span class="hljs-function"><span class="hljs-params">reply</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">,</span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="n"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="n"><span class="hljs-function"><span class="hljs-params">flags</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function">android</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">os</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">RemoteException</span></span><span class="hljs-function"> </span><span class="p">{</span>
            <span class="n"><span class="hljs-keyword">switch</span></span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="p">{</span>
                <span class="k"><span class="hljs-keyword">case</span></span> <span class="n">INTERFACE_TRANSACTION</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">reply</span><span class="p">.</span><span class="n">writeString</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">);</span>
                    <span class="n"><span class="hljs-keyword">return</span></span> <span class="nb"><span class="hljs-keyword">true</span></span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k"><span class="hljs-keyword">case</span></span> <span class="n">TRANSACTION_getPid</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">enforceInterface</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">);</span>
                    <span class="n"><span class="hljs-keyword">int</span></span> <span class="n">_result</span> <span class="p">=</span> <span class="n"><span class="hljs-keyword">this</span></span><span class="p">.</span><span class="n">getPid</span><span class="p">();</span>
                    <span class="n">reply</span><span class="p">.</span><span class="n">writeNoException</span><span class="p">();</span>
                    <span class="n">reply</span><span class="p">.</span><span class="n">writeInt</span><span class="p">(</span><span class="n">_result</span><span class="p">);</span>
                    <span class="n"><span class="hljs-keyword">return</span></span> <span class="nb"><span class="hljs-keyword">true</span></span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k"><span class="hljs-keyword">case</span></span> <span class="n">TRANSACTION_getMyData</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">enforceInterface</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">);</span>
                    <span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">.</span><span class="n">MyData</span> <span class="n">_result</span> <span class="p">=</span> <span class="n"><span class="hljs-keyword">this</span></span><span class="p">.</span><span class="n">getMyData</span><span class="p">();</span>
                    <span class="n">reply</span><span class="p">.</span><span class="n">writeNoException</span><span class="p">();</span>
                    <span class="k"><span class="hljs-keyword">if</span></span> <span class="p">((</span><span class="n">_result</span> <span class="c1">!= <span class="hljs-keyword">null</span>)) {
</span>                        <span class="n">reply</span><span class="p">.</span><span class="n">writeInt</span><span class="p">(</span><span class="m"><span class="hljs-number">1</span></span><span class="p">);</span>
                        <span class="n">_result</span><span class="p">.</span><span class="n">writeToParcel</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcelable</span><span class="p">.</span><span class="n">PARCELABLE_WRITE_RETURN_VALUE</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k"><span class="hljs-keyword">else</span></span> <span class="p">{</span>
                        <span class="n">reply</span><span class="p">.</span><span class="n">writeInt</span><span class="p">(</span><span class="m"><span class="hljs-number">0</span></span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="n"><span class="hljs-keyword">return</span></span> <span class="nb"><span class="hljs-keyword">true</span></span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n"><span class="hljs-keyword">return</span></span> <span class="n"><span class="hljs-keyword">super</span></span><span class="p">.</span><span class="n">onTransact</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">reply</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n"><span class="hljs-keyword">private</span></span> <span class="n"><span class="hljs-keyword">static</span></span> <span class="n"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-title">Proxy</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="n"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">yuanhh</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">appbinderdemo</span></span></span><span class="p"><span class="hljs-class">.</span></span><span class="n"><span class="hljs-class"><span class="hljs-title">IRemoteService</span></span></span><span class="hljs-class"> </span><span class="p">{</span>
            <span class="n"><span class="hljs-keyword">private</span></span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">IBinder</span> <span class="n">mRemote</span><span class="p">;</span>

            <span class="p"><span class="hljs-comment">/**</span></span><span class="hljs-comment">
             </span><span class="p"><span class="hljs-comment">*</span></span><span class="hljs-comment"> </span><span class="n"><span class="hljs-comment">Proxy</span></span><span class="err"><span class="hljs-comment">构造函数</span></span><span class="hljs-comment">
             </span><span class="p"><span class="hljs-comment">*/</span></span>
            <span class="n">Proxy</span><span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">IBinder</span> <span class="n">remote</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">mRemote</span> <span class="p">=</span> <span class="n">remote</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="p"><span class="hljs-meta">@</span></span><span class="n"><span class="hljs-meta">Override</span></span>
            <span class="k"><span class="hljs-keyword">public</span></span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n"><span class="hljs-function">IBinder</span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">asBinder</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="p">{</span>
                <span class="n"><span class="hljs-keyword">return</span></span> <span class="n">mRemote</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k"><span class="hljs-keyword">public</span></span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="k"><span class="hljs-function">String</span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">getInterfaceDescriptor</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="p">{</span>
                <span class="n"><span class="hljs-keyword">return</span></span> <span class="n">DESCRIPTOR</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="p"><span class="hljs-meta">@</span></span><span class="n"><span class="hljs-meta">Override</span></span>
            <span class="k"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">getPid</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function">android</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">os</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">RemoteException</span></span><span class="hljs-function"> </span><span class="p">{</span>
                <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcel</span> <span class="n">_data</span> <span class="p">=</span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcel</span><span class="p">.</span><span class="n">obtain</span><span class="p">();</span>
                <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcel</span> <span class="n">_reply</span> <span class="p">=</span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcel</span><span class="p">.</span><span class="n">obtain</span><span class="p">();</span>
                <span class="n"><span class="hljs-keyword">int</span></span> <span class="n">_result</span><span class="p">;</span>
                <span class="n"><span class="hljs-keyword">try</span></span> <span class="p">{</span>
                    <span class="n">_data</span><span class="p">.</span><span class="n">writeInterfaceToken</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">);</span>
                    <span class="n">mRemote</span><span class="p">.</span><span class="n">transact</span><span class="p">(</span><span class="n">Stub</span><span class="p">.</span><span class="n">TRANSACTION_getPid</span><span class="p">,</span> <span class="n">_data</span><span class="p">,</span> <span class="n">_reply</span><span class="p">,</span> <span class="m"><span class="hljs-number">0</span></span><span class="p">);</span>
                    <span class="n">_reply</span><span class="p">.</span><span class="n">readException</span><span class="p">();</span>
                    <span class="n">_result</span> <span class="p">=</span> <span class="n">_reply</span><span class="p">.</span><span class="n">readInt</span><span class="p">();</span>
                <span class="p">}</span> <span class="n"><span class="hljs-keyword">finally</span></span> <span class="p">{</span>
                    <span class="n">_reply</span><span class="p">.</span><span class="n">recycle</span><span class="p">();</span>
                    <span class="n">_data</span><span class="p">.</span><span class="n">recycle</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="n"><span class="hljs-keyword">return</span></span> <span class="n">_result</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="p"><span class="hljs-meta">@</span></span><span class="n"><span class="hljs-meta">Override</span></span>
            <span class="k"><span class="hljs-keyword">public</span></span> <span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">.</span><span class="n"><span class="hljs-function">MyData</span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">getMyData</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function">android</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">os</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">RemoteException</span></span><span class="hljs-function"> </span><span class="p">{</span>
                <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcel</span> <span class="n">_data</span> <span class="p">=</span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcel</span><span class="p">.</span><span class="n">obtain</span><span class="p">();</span>
                <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcel</span> <span class="n">_reply</span> <span class="p">=</span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">Parcel</span><span class="p">.</span><span class="n">obtain</span><span class="p">();</span>
                <span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">.</span><span class="n">MyData</span> <span class="n">_result</span><span class="p">;</span>
                <span class="n"><span class="hljs-keyword">try</span></span> <span class="p">{</span>
                    <span class="n">_data</span><span class="p">.</span><span class="n">writeInterfaceToken</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">);</span>
                    <span class="n">mRemote</span><span class="p">.</span><span class="n">transact</span><span class="p">(</span><span class="n">Stub</span><span class="p">.</span><span class="n">TRANSACTION_getMyData</span><span class="p">,</span> <span class="n">_data</span><span class="p">,</span> <span class="n">_reply</span><span class="p">,</span> <span class="m"><span class="hljs-number">0</span></span><span class="p">);</span>
                    <span class="n">_reply</span><span class="p">.</span><span class="n">readException</span><span class="p">();</span>
                    <span class="k"><span class="hljs-keyword">if</span></span> <span class="p">((</span><span class="m"><span class="hljs-number">0</span></span> <span class="c1">!= _reply.readInt())) {
</span>                        <span class="n">_result</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">.</span><span class="n">MyData</span><span class="p">.</span><span class="n">CREATOR</span><span class="p">.</span><span class="n">createFromParcel</span><span class="p">(</span><span class="n">_reply</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k"><span class="hljs-keyword">else</span></span> <span class="p">{</span>
                        <span class="n">_result</span> <span class="p">=</span> <span class="n"><span class="hljs-keyword">null</span></span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="n"><span class="hljs-keyword">finally</span></span> <span class="p">{</span>
                    <span class="n">_reply</span><span class="p">.</span><span class="n">recycle</span><span class="p">();</span>
                    <span class="n">_data</span><span class="p">.</span><span class="n">recycle</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="n"><span class="hljs-keyword">return</span></span> <span class="n">_result</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n"><span class="hljs-keyword">static</span></span> <span class="n"><span class="hljs-keyword">final</span></span> <span class="n"><span class="hljs-keyword">int</span></span> <span class="n">TRANSACTION_getPid</span> <span class="p">=</span> <span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">IBinder</span><span class="p">.</span><span class="n">FIRST_CALL_TRANSACTION</span> <span class="p">+</span> <span class="m"><span class="hljs-number">0</span></span><span class="p">);</span>
        <span class="n"><span class="hljs-keyword">static</span></span> <span class="n"><span class="hljs-keyword">final</span></span> <span class="n"><span class="hljs-keyword">int</span></span> <span class="n">TRANSACTION_getMyData</span> <span class="p">=</span> <span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">IBinder</span><span class="p">.</span><span class="n">FIRST_CALL_TRANSACTION</span> <span class="p">+</span> <span class="m"><span class="hljs-number">1</span></span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">getPid</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function">android</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">os</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">RemoteException</span></span><span class="p">;</span>

    <span class="k"><span class="hljs-keyword">public</span></span> <span class="n">com</span><span class="p">.</span><span class="n">yuanhh</span><span class="p">.</span><span class="n">appbinderdemo</span><span class="p">.</span><span class="n"><span class="hljs-function">MyData</span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">getMyData</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function">android</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">os</span></span><span class="p"><span class="hljs-function">.</span></span><span class="n"><span class="hljs-function">RemoteException</span></span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

								<hr>
								<font color="#004B97"><strong>微信公众号 </strong></font>
<a target="_blank" href="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/damoyuan_logo.png">
	<font color="#f57e42"><strong>Android达摩院</strong></font>
</a>

<font color="#004B97"><strong> | 微博</strong></font>
<a target="_blank" href="http://weibo.com/gityuan">
	<font color="#f57e42"><strong>weibo.com/gityuan</strong></font>
</a>

<font color="#004B97"><strong> | 博客</strong></font>
<a target="_blank" href="http://gityuan.com/talk/">
	<font color="#f57e42"><strong>留言区交流</strong></font>
</a>
<img src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/damoyuan_logo.png" alt="android-damoyuan">

                <hr>
								

                <ul class="pager">
                    
                    <li class="previous">
                        <a target="_blank" href="http://gityuan.com/2015/11/22/binder-use/" data-toggle="tooltip" data-placement="top" title="Binder系列8—如何使用Binder">
                        上一篇<br>
                        <span>Binder系列8—如何使用Binder</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a target="_blank" href="http://gityuan.com/2015/11/28/binder-summary/" data-toggle="tooltip" data-placement="top" title="Binder系列10—总结">
                        下一篇<br>
                        <span>Binder系列10—总结</span>
                        </a>
                    </li>
                    
                </ul>


                

            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5 id="catalog">
                        <a class="catalog-toggle" href="http://gityuan.com/2015/11/23/binder-aidl/#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"><li class="h2_nav"><a href="http://gityuan.com/2015/11/23/binder-aidl/#%E4%B8%80aidl" rel="nofollow">一、AIDL</a></li><li class="h3_nav active"><a href="http://gityuan.com/2015/11/23/binder-aidl/#11-server%E7%AB%AF" rel="nofollow">1.1 Server端</a></li><li class="h3_nav"><a href="http://gityuan.com/2015/11/23/binder-aidl/#12-client%E7%AB%AF" rel="nofollow">1.2 Client端</a></li><li class="h3_nav"><a href="http://gityuan.com/2015/11/23/binder-aidl/#13-aidl%E6%96%87%E4%BB%B6" rel="nofollow">1.3 AIDL文件</a></li><li class="h3_nav"><a href="http://gityuan.com/2015/11/23/binder-aidl/#14-parcel%E6%95%B0%E6%8D%AE" rel="nofollow">1.4 Parcel数据</a></li><li class="h3_nav"><a href="http://gityuan.com/2015/11/23/binder-aidl/#15-%E8%BF%90%E8%A1%8C" rel="nofollow">1.5 运行</a></li><li class="h2_nav"><a href="http://gityuan.com/2015/11/23/binder-aidl/#%E4%BA%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90" rel="nofollow">二、原理分析</a></li></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5 id="-1"><a target="_blank" href="http://gityuan.com/tags/">标签</a></h5>
                    <div class="tags">
                      
                            <a target="_blank" href="http://gityuan.com/tags/#android" title="android" rel="153">
                                    android
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#%E7%BB%84%E4%BB%B6%E7%B3%BB%E5%88%97" title="组件系列" rel="19">
                                    组件系列
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#else" title="else" rel="3">
                                    else
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#debug" title="debug" rel="19">
                                    debug
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#%E6%9D%83%E9%99%90" title="权限" rel="2">
                                    权限
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#web" title="web" rel="2">
                                    web
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#tool" title="tool" rel="12">
                                    tool
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#java" title="java" rel="12">
                                    java
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#performance" title="performance" rel="4">
                                    performance
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#app" title="app" rel="2">
                                    app
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#algorithm" title="algorithm" rel="1">
                                    algorithm
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#%E8%BF%9B%E7%A8%8B%E7%B3%BB%E5%88%97" title="进程系列" rel="13">
                                    进程系列
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#%E8%99%9A%E6%8B%9F%E6%9C%BA" title="虚拟机" rel="1">
                                    虚拟机
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#memory" title="memory" rel="5">
                                    memory
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#jvm" title="jvm" rel="5">
                                    jvm
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#linux" title="linux" rel="11">
                                    linux
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#binder" title="binder" rel="19">
                                    binder
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#ipc" title="ipc" rel="3">
                                    ipc
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#handler" title="handler" rel="3">
                                    handler
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#process" title="process" rel="6">
                                    process
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#power" title="power" rel="1">
                                    power
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8" title="系统启动" rel="6">
                                    系统启动
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#AMS" title="AMS" rel="2">
                                    AMS
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#PMS" title="PMS" rel="1">
                                    PMS
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#%E8%87%AA%E5%AD%A6%E7%BC%96%E7%A8%8B" title="自学编程" rel="1">
                                    自学编程
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#stability" title="stability" rel="8">
                                    stability
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#%E7%BB%84%E4%BB%B6" title="组件" rel="3">
                                    组件
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#art" title="art" rel="2">
                                    art
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#graphic" title="graphic" rel="1">
                                    graphic
                            </a>
                      
                            <a target="_blank" href="http://gityuan.com/tags/#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B" title="实战案例" rel="7">
                                    实战案例
                            </a>
                      
                    </div>
                </section> 
                 

                <!-- Friends Blog -->
                <!-- 
                 -->
            </div>
        </div>
    </div>
</article>






<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a target="_blank" href="http://weibo.com/gityuan">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/gityuan">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    
										
                    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/gityuan">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="http://gityuan.com/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright © Gityuan  2019 | Powered by Jekyll with Hux Theme
                </p>
                <!-- 流量统计 -->
								<div style="display:none">
                                    <!--
									<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1000098804'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1000098804%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>-->
                                    
                                    <!-- Baidu Tongji -->
                                    <script>
                                    var _hmt = _hmt || [];
                                    (function() {
                                      var hm = document.createElement("script");
                                      hm.src = "https://hm.baidu.com/hm.js?3b1c71bfd9641a47009f87240c135d75";
                                      var s = document.getElementsByTagName("script")[0]; 
                                      s.parentNode.insertBefore(hm, s);
                                    })();
                                    </script>
								</div>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/jquery.min.js.下载"></script>

<!-- Bootstrap Core JavaScript -->
<script src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/bootstrap.min.js.下载"></script>

<!-- Custom Theme JavaScript -->
<script src="./Binder系列9—如何使用AIDL - Gityuan博客 _ 袁辉辉的Android博客_files/hux-blog.min.js.下载"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body></html>