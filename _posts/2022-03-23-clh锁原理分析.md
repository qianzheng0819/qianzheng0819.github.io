---
layout: post
title:  "clh锁原理分析"
date:   2022-03-23 14:24:00 +0800
categories: java
tags: java
description:
---

## CLH lock
CLH是一个基于链表（队列）非线程饥饿的自旋（公平）锁，由于是 Craig、Landin 和 Hagersten三人的发明，因此命名为CLH锁。每一个等待锁的线程封装成节点，不断自旋判断前一个节点的状态，如果前一个节点释放锁就结束自旋      

特点：该算法只一个CAS操作，即可让所有等待获取锁的线程构建有序全局队列。   

### 原理
***
1、首先有一个尾节点指针，通过这个尾结点指针来构建等待线程的逻辑队列（所有每个线程还应该保存前面Node的状态，链表形式），因此能确保线程线程先到先服务的公平性，因此尾  指针可以说是构建逻辑队列的桥梁；此外这个尾节点指针是原子引用类型，避免了多线程并发操作的线程安全性问题；   

2、每个等待锁的线程在自己的前驱节点某个变量上自旋等待，等待前驱解锁之后即可去获取锁。

### 图解
***
<div align="center">
<img src="{{ site.baseurl }}/assets/images/2022-pic/p1.svg" />
</div>  


<div align="center">
<img src="{{ site.baseurl }}/assets/images/2022-pic/p2.svg" />
</div>  
